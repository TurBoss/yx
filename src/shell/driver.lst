                              1 ;--------------------------------------------------------
                              2 ; File Created by SDCC : free open source ANSI-C Compiler
                              3 ; Version 3.1.0 #7066 (Jun 14 2012) (Linux)
                              4 ; This file was generated Tue Nov 27 20:33:01 2012
                              5 ;--------------------------------------------------------
                              6 	.module driver
                              7 	.optsdcc -mz80
                              8 	
                              9 ;--------------------------------------------------------
                             10 ; Public variables in this module
                             11 ;--------------------------------------------------------
                             12 	.globl _tmr_install
                             13 	.globl _mem_allocate
                             14 	.globl _drv_first
                             15 	.globl _drv_register
                             16 	.globl _drv_query
                             17 ;--------------------------------------------------------
                             18 ; special function registers
                             19 ;--------------------------------------------------------
                             20 ;--------------------------------------------------------
                             21 ;  ram data
                             22 ;--------------------------------------------------------
                             23 	.area _DATA
   0000                      24 _drv_first::
   0000                      25 	.ds 2
                             26 ;--------------------------------------------------------
                             27 ; overlayable items in  ram 
                             28 ;--------------------------------------------------------
                             29 	.area _OVERLAY
                             30 ;--------------------------------------------------------
                             31 ; external initialized ram data
                             32 ;--------------------------------------------------------
                             33 ;--------------------------------------------------------
                             34 ; global & static initialisations
                             35 ;--------------------------------------------------------
                             36 	.area _HOME
                             37 	.area _GSINIT
                             38 	.area _GSFINAL
                             39 	.area _GSINIT
                             40 ;--------------------------------------------------------
                             41 ; Home
                             42 ;--------------------------------------------------------
                             43 	.area _HOME
                             44 	.area _HOME
                             45 ;--------------------------------------------------------
                             46 ; code
                             47 ;--------------------------------------------------------
                             48 	.area _CODE
                             49 ;driver.c:14: result drv_register(
                             50 ;	---------------------------------
                             51 ; Function drv_register
                             52 ; ---------------------------------
   0000                      53 _drv_register_start::
   0000                      54 _drv_register:
   0000 DD E5                55 	push	ix
   0002 DD 21 00 00          56 	ld	ix,#0
   0006 DD 39                57 	add	ix,sp
                             58 ;driver.c:25: driver_t *d=mem_allocate(sizeof(driver_t),KALLOC);
   0008 21 00 01             59 	ld	hl,#0x0100
   000B E5                   60 	push	hl
   000C 21 11 00             61 	ld	hl,#0x0011
   000F E5                   62 	push	hl
   0010 CDr00s00             63 	call	_mem_allocate
   0013 F1                   64 	pop	af
   0014 F1                   65 	pop	af
   0015 EB                   66 	ex	de,hl
                             67 ;driver.c:26: d->id0=id0;
   0016 DD 7E 04             68 	ld	a,4 (ix)
   0019 12                   69 	ld	(de),a
                             70 ;driver.c:27: d->id1=id1;
   001A 6B                   71 	ld	l,e
   001B 62                   72 	ld	h,d
   001C 23                   73 	inc	hl
   001D DD 7E 05             74 	ld	a,5 (ix)
   0020 77                   75 	ld	(hl),a
                             76 ;driver.c:28: d->id2=id2;
   0021 6B                   77 	ld	l,e
   0022 62                   78 	ld	h,d
   0023 23                   79 	inc	hl
   0024 23                   80 	inc	hl
   0025 DD 7E 06             81 	ld	a,6 (ix)
   0028 77                   82 	ld	(hl),a
                             83 ;driver.c:29: d->open=open;
   0029 6B                   84 	ld	l,e
   002A 62                   85 	ld	h,d
   002B 23                   86 	inc	hl
   002C 23                   87 	inc	hl
   002D 23                   88 	inc	hl
   002E DD 7E 07             89 	ld	a,7 (ix)
   0031 77                   90 	ld	(hl),a
   0032 23                   91 	inc	hl
   0033 DD 7E 08             92 	ld	a,8 (ix)
   0036 77                   93 	ld	(hl),a
                             94 ;driver.c:30: d->close=close;
   0037 21 05 00             95 	ld	hl,#0x0005
   003A 19                   96 	add	hl,de
   003B DD 7E 09             97 	ld	a,9 (ix)
   003E 77                   98 	ld	(hl),a
   003F 23                   99 	inc	hl
   0040 DD 7E 0A            100 	ld	a,10 (ix)
   0043 77                  101 	ld	(hl),a
                            102 ;driver.c:31: d->read_async=read_async;
   0044 21 07 00            103 	ld	hl,#0x0007
   0047 19                  104 	add	hl,de
   0048 DD 7E 0B            105 	ld	a,11 (ix)
   004B 77                  106 	ld	(hl),a
   004C 23                  107 	inc	hl
   004D DD 7E 0C            108 	ld	a,12 (ix)
   0050 77                  109 	ld	(hl),a
                            110 ;driver.c:32: d->write_async=write_async;
   0051 21 09 00            111 	ld	hl,#0x0009
   0054 19                  112 	add	hl,de
   0055 DD 7E 0D            113 	ld	a,13 (ix)
   0058 77                  114 	ld	(hl),a
   0059 23                  115 	inc	hl
   005A DD 7E 0E            116 	ld	a,14 (ix)
   005D 77                  117 	ld	(hl),a
                            118 ;driver.c:33: d->ioctl=ioctl;
   005E 21 0B 00            119 	ld	hl,#0x000B
   0061 19                  120 	add	hl,de
   0062 DD 7E 0F            121 	ld	a,15 (ix)
   0065 77                  122 	ld	(hl),a
   0066 23                  123 	inc	hl
   0067 DD 7E 10            124 	ld	a,16 (ix)
   006A 77                  125 	ld	(hl),a
                            126 ;driver.c:34: d->timer_hook=timer_hook;
   006B 21 0D 00            127 	ld	hl,#0x000D
   006E 19                  128 	add	hl,de
   006F DD 7E 11            129 	ld	a,17 (ix)
   0072 77                  130 	ld	(hl),a
   0073 23                  131 	inc	hl
   0074 DD 7E 12            132 	ld	a,18 (ix)
   0077 77                  133 	ld	(hl),a
                            134 ;driver.c:35: d->next=drv_first;
   0078 21 0F 00            135 	ld	hl,#0x000F
   007B 19                  136 	add	hl,de
   007C FD 21r00s00         137 	ld	iy,#_drv_first
   0080 FD 7E 00            138 	ld	a,0 (iy)
   0083 77                  139 	ld	(hl),a
   0084 23                  140 	inc	hl
   0085 FD 7E 01            141 	ld	a,1 (iy)
   0088 77                  142 	ld	(hl),a
                            143 ;driver.c:36: drv_first=d;
   0089 FD 73 00            144 	ld	0 (iy),e
   008C FD 72 01            145 	ld	1 (iy),d
                            146 ;driver.c:38: if (init_fn) init_fn(d);
   008F DD 7E 14            147 	ld	a,20 (ix)
   0092 DD B6 13            148 	or	a,19 (ix)
   0095 28 0B               149 	jr	Z,00102$
   0097 D5                  150 	push	de
   0098 DD 6E 13            151 	ld	l,19 (ix)
   009B DD 66 14            152 	ld	h,20 (ix)
   009E CDr00s00            153 	call	__sdcc_call_hl
   00A1 F1                  154 	pop	af
   00A2                     155 00102$:
                            156 ;driver.c:41: tmr_install(timer_hook,EVERYTIME);
   00A2 21 00 00            157 	ld	hl,#0x0000
   00A5 E5                  158 	push	hl
   00A6 DD 6E 11            159 	ld	l,17 (ix)
   00A9 DD 66 12            160 	ld	h,18 (ix)
   00AC E5                  161 	push	hl
   00AD CDr00s00            162 	call	_tmr_install
   00B0 F1                  163 	pop	af
   00B1 F1                  164 	pop	af
   00B2 DD E1               165 	pop	ix
   00B4 C9                  166 	ret
   00B5                     167 _drv_register_end::
                            168 ;driver.c:47: driver_t *drv_query(uint8_t id0, uint8_t id1, uint8_t id2) {
                            169 ;	---------------------------------
                            170 ; Function drv_query
                            171 ; ---------------------------------
   00B5                     172 _drv_query_start::
   00B5                     173 _drv_query:
   00B5 DD E5               174 	push	ix
   00B7 DD 21 00 00         175 	ld	ix,#0
   00BB DD 39               176 	add	ix,sp
   00BD 3B                  177 	dec	sp
                            178 ;driver.c:48: driver_t *d=NULL;
   00BE 01 00 00            179 	ld	bc,#0x0000
                            180 ;driver.c:49: driver_t *iter=drv_first;
   00C1 ED 5Br00s00         181 	ld	de,(_drv_first)
                            182 ;driver.c:51: while (!d && iter) 
   00C5                     183 00107$:
   00C5 78                  184 	ld	a,b
   00C6 B1                  185 	or	a,c
   00C7 20 33               186 	jr	NZ,00109$
   00C9 7A                  187 	ld	a,d
   00CA B3                  188 	or	a,e
   00CB 28 2F               189 	jr	Z,00109$
                            190 ;driver.c:52: if (iter->id0==id0 && iter->id1==id1 && iter->id2==id2)
   00CD 1A                  191 	ld	a,(de)
   00CE DD 77 FF            192 	ld	-1 (ix), a
   00D1 DD 96 04            193 	sub	a, 4 (ix)
   00D4 20 1D               194 	jr	NZ,00102$
   00D6 6B                  195 	ld	l,e
   00D7 62                  196 	ld	h,d
   00D8 23                  197 	inc	hl
   00D9 7E                  198 	ld	a,(hl)
   00DA DD 77 FF            199 	ld	-1 (ix), a
   00DD DD 96 05            200 	sub	a, 5 (ix)
   00E0 20 11               201 	jr	NZ,00102$
   00E2 6B                  202 	ld	l,e
   00E3 62                  203 	ld	h,d
   00E4 23                  204 	inc	hl
   00E5 23                  205 	inc	hl
   00E6 7E                  206 	ld	a,(hl)
   00E7 DD 77 FF            207 	ld	-1 (ix), a
   00EA DD 96 06            208 	sub	a, 6 (ix)
   00ED 20 04               209 	jr	NZ,00102$
                            210 ;driver.c:53: d=iter;
   00EF 4B                  211 	ld	c,e
   00F0 42                  212 	ld	b,d
   00F1 18 D2               213 	jr	00107$
   00F3                     214 00102$:
                            215 ;driver.c:55: iter=iter->next;
   00F3 21 0F 00            216 	ld	hl,#0x000F
   00F6 19                  217 	add	hl,de
   00F7 5E                  218 	ld	e,(hl)
   00F8 23                  219 	inc	hl
   00F9 56                  220 	ld	d,(hl)
   00FA 18 C9               221 	jr	00107$
   00FC                     222 00109$:
                            223 ;driver.c:57: return d;
   00FC 69                  224 	ld	l,c
   00FD 60                  225 	ld	h,b
   00FE DD F9               226 	ld	sp,ix
   0100 DD E1               227 	pop	ix
   0102 C9                  228 	ret
   0103                     229 _drv_query_end::
                            230 	.area _CODE
                            231 	.area _CABS
