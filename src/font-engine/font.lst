                              1 ;--------------------------------------------------------
                              2 ; File Created by SDCC : free open source ANSI-C Compiler
                              3 ; Version 3.1.0 #7066 (Jun 14 2012) (Linux)
                              4 ; This file was generated Tue Nov 27 20:50:40 2012
                              5 ;--------------------------------------------------------
                              6 	.module font
                              7 	.optsdcc -mz80
                              8 	
                              9 ;--------------------------------------------------------
                             10 ; Public variables in this module
                             11 ;--------------------------------------------------------
                             12 	.globl _fnt_get_font_info
                             13 	.globl _fnt_measure_string
                             14 ;--------------------------------------------------------
                             15 ; special function registers
                             16 ;--------------------------------------------------------
                             17 ;--------------------------------------------------------
                             18 ;  ram data
                             19 ;--------------------------------------------------------
                             20 	.area _DATA
                             21 ;--------------------------------------------------------
                             22 ; overlayable items in  ram 
                             23 ;--------------------------------------------------------
                             24 	.area _OVERLAY
                             25 ;--------------------------------------------------------
                             26 ; external initialized ram data
                             27 ;--------------------------------------------------------
                             28 ;--------------------------------------------------------
                             29 ; global & static initialisations
                             30 ;--------------------------------------------------------
                             31 	.area _HOME
                             32 	.area _GSINIT
                             33 	.area _GSFINAL
                             34 	.area _GSINIT
                             35 ;--------------------------------------------------------
                             36 ; Home
                             37 ;--------------------------------------------------------
                             38 	.area _HOME
                             39 	.area _HOME
                             40 ;--------------------------------------------------------
                             41 ; code
                             42 ;--------------------------------------------------------
                             43 	.area _CODE
                             44 ;font.c:11: void fnt_get_font_info(
                             45 ;	---------------------------------
                             46 ; Function fnt_get_font_info
                             47 ; ---------------------------------
   0000                      48 _fnt_get_font_info_start::
   0000                      49 _fnt_get_font_info:
   0000 DD E5                50 	push	ix
   0002 DD 21 00 00          51 	ld	ix,#0
   0006 DD 39                52 	add	ix,sp
   0008 21 F7 FF             53 	ld	hl,#-9
   000B 39                   54 	add	hl,sp
   000C F9                   55 	ld	sp,hl
                             56 ;font.c:25: (*bytes_per_glyph_line)	=	1;
   000D DD 7E 06             57 	ld	a,6 (ix)
   0010 DD 77 FE             58 	ld	-2 (ix),a
   0013 DD 7E 07             59 	ld	a,7 (ix)
   0016 DD 77 FF             60 	ld	-1 (ix),a
   0019 DD 6E FE             61 	ld	l,-2 (ix)
   001C DD 66 FF             62 	ld	h,-1 (ix)
   001F 36 01                63 	ld	(hl),#0x01
                             64 ;font.c:26: (*glyph_lines)		=	8;
   0021 DD 4E 08             65 	ld	c,8 (ix)
   0024 DD 46 09             66 	ld	b,9 (ix)
   0027 3E 08                67 	ld	a,#0x08
   0029 02                   68 	ld	(bc),a
                             69 ;font.c:27: (*xmax)			=	0;
   002A DD 7E 0A             70 	ld	a,10 (ix)
   002D DD 77 FC             71 	ld	-4 (ix),a
   0030 DD 7E 0B             72 	ld	a,11 (ix)
   0033 DD 77 FD             73 	ld	-3 (ix),a
   0036 DD 6E FC             74 	ld	l,-4 (ix)
   0039 DD 66 FD             75 	ld	h,-3 (ix)
   003C 36 00                76 	ld	(hl),#0x00
                             77 ;font.c:28: (*descent)		=	0;
   003E DD 7E 0C             78 	ld	a,12 (ix)
   0041 DD 77 FA             79 	ld	-6 (ix),a
   0044 DD 7E 0D             80 	ld	a,13 (ix)
   0047 DD 77 FB             81 	ld	-5 (ix),a
   004A DD 6E FA             82 	ld	l,-6 (ix)
   004D DD 66 FB             83 	ld	h,-5 (ix)
   0050 36 00                84 	ld	(hl),#0x00
                             85 ;font.c:29: (*xmin)			=	0;
   0052 DD 5E 0E             86 	ld	e,14 (ix)
   0055 DD 56 0F             87 	ld	d,15 (ix)
   0058 3E 00                88 	ld	a,#0x00
   005A 12                   89 	ld	(de),a
                             90 ;font.c:31: switch(font->font_generation) {
   005B DD 7E 04             91 	ld	a,4 (ix)
   005E DD 77 F8             92 	ld	-8 (ix),a
   0061 DD 7E 05             93 	ld	a,5 (ix)
   0064 DD 77 F9             94 	ld	-7 (ix),a
   0067 DD 6E F8             95 	ld	l,-8 (ix)
   006A DD 66 F9             96 	ld	h,-7 (ix)
   006D 7E                   97 	ld	a,(hl)
   006E DD 77 F7             98 	ld	-9 (ix), a
   0071 D6 07                99 	sub	a, #0x07
   0073 28 15               100 	jr	Z,00102$
   0075 DD 7E F7            101 	ld	a,-9 (ix)
   0078 D6 0C               102 	sub	a, #0x0C
   007A 20 5B               103 	jr	NZ,00103$
                            104 ;font.c:33: (*xmin)=font->xmin;
   007C DD 7E F8            105 	ld	a,-8 (ix)
   007F C6 07               106 	add	a, #0x07
   0081 6F                  107 	ld	l,a
   0082 DD 7E F9            108 	ld	a,-7 (ix)
   0085 CE 00               109 	adc	a, #0x00
   0087 67                  110 	ld	h,a
   0088 7E                  111 	ld	a,(hl)
   0089 12                  112 	ld	(de),a
                            113 ;font.c:34: case FGEN_1: 
   008A                     114 00102$:
                            115 ;font.c:35: (*bytes_per_glyph_line)=font->bytes_per_glyph_line;
   008A DD 6E F8            116 	ld	l,-8 (ix)
   008D DD 66 F9            117 	ld	h,-7 (ix)
   0090 23                  118 	inc	hl
   0091 23                  119 	inc	hl
   0092 23                  120 	inc	hl
   0093 7E                  121 	ld	a,(hl)
   0094 DD 6E FE            122 	ld	l,-2 (ix)
   0097 DD 66 FF            123 	ld	h,-1 (ix)
   009A 77                  124 	ld	(hl),a
                            125 ;font.c:36: (*glyph_lines)=font->glyph_lines;
   009B FD 21 04 00         126 	ld	iy,#0x0004
   009F DD 5E F8            127 	ld	e,-8 (ix)
   00A2 DD 56 F9            128 	ld	d,-7 (ix)
   00A5 FD 19               129 	add	iy, de
   00A7 FD 7E 00            130 	ld	a, 0 (iy)
   00AA 02                  131 	ld	(bc),a
                            132 ;font.c:37: (*xmax)=font->xmax;
   00AB FD 21 05 00         133 	ld	iy,#0x0005
   00AF DD 5E F8            134 	ld	e,-8 (ix)
   00B2 DD 56 F9            135 	ld	d,-7 (ix)
   00B5 FD 19               136 	add	iy, de
   00B7 FD 7E 00            137 	ld	a, 0 (iy)
   00BA DD 6E FC            138 	ld	l,-4 (ix)
   00BD DD 66 FD            139 	ld	h,-3 (ix)
   00C0 77                  140 	ld	(hl),a
                            141 ;font.c:38: (*descent)=font->descent;
   00C1 FD 21 06 00         142 	ld	iy,#0x0006
   00C5 DD 5E F8            143 	ld	e,-8 (ix)
   00C8 DD 56 F9            144 	ld	d,-7 (ix)
   00CB FD 19               145 	add	iy, de
   00CD FD 7E 00            146 	ld	a, 0 (iy)
   00D0 DD 6E FA            147 	ld	l,-6 (ix)
   00D3 DD 66 FB            148 	ld	h,-5 (ix)
   00D6 77                  149 	ld	(hl),a
                            150 ;font.c:40: }
   00D7                     151 00103$:
                            152 ;font.c:42: (*first_glyph_addr) = ((word)font) + (font->font_generation);
   00D7 DD 7E 10            153 	ld	a,16 (ix)
   00DA DD 77 F8            154 	ld	-8 (ix),a
   00DD DD 7E 11            155 	ld	a,17 (ix)
   00E0 DD 77 F9            156 	ld	-7 (ix),a
   00E3 DD 6E 04            157 	ld	l,4 (ix)
   00E6 DD 66 05            158 	ld	h,5 (ix)
   00E9 DD 5E F7            159 	ld	e,-9 (ix)
   00EC 16 00               160 	ld	d,#0x00
   00EE 19                  161 	add	hl,de
   00EF EB                  162 	ex	de,hl
   00F0 DD 6E F8            163 	ld	l,-8 (ix)
   00F3 DD 66 F9            164 	ld	h,-7 (ix)
   00F6 73                  165 	ld	(hl),e
   00F7 23                  166 	inc	hl
   00F8 72                  167 	ld	(hl),d
                            168 ;font.c:43: (*glyph_size_in_bytes) = ( (*glyph_lines) + 1 ) * (*bytes_per_glyph_line) + 1 ;
   00F9 DD 5E 12            169 	ld	e,18 (ix)
   00FC DD 56 13            170 	ld	d,19 (ix)
   00FF 0A                  171 	ld	a,(bc)
   0100 4F                  172 	ld	c,a
   0101 06 00               173 	ld	b,#0x00
   0103 03                  174 	inc	bc
   0104 DD 6E FE            175 	ld	l,-2 (ix)
   0107 DD 66 FF            176 	ld	h,-1 (ix)
   010A 6E                  177 	ld	l,(hl)
   010B 26 00               178 	ld	h,#0x00
   010D D5                  179 	push	de
   010E E5                  180 	push	hl
   010F C5                  181 	push	bc
   0110 CDr00s00            182 	call	__mulint_rrx_s
   0113 F1                  183 	pop	af
   0114 F1                  184 	pop	af
   0115 D1                  185 	pop	de
   0116 23                  186 	inc	hl
   0117 EB                  187 	ex	de,hl
   0118 73                  188 	ld	(hl),e
   0119 23                  189 	inc	hl
   011A 72                  190 	ld	(hl),d
   011B DD F9               191 	ld	sp,ix
   011D DD E1               192 	pop	ix
   011F C9                  193 	ret
   0120                     194 _fnt_get_font_info_end::
                            195 ;font.c:47: void fnt_measure_string(font_t *font, string string, byte *widths)
                            196 ;	---------------------------------
                            197 ; Function fnt_measure_string
                            198 ; ---------------------------------
   0120                     199 _fnt_measure_string_start::
   0120                     200 _fnt_measure_string:
   0120 DD E5               201 	push	ix
   0122 DD 21 00 00         202 	ld	ix,#0
   0126 DD 39               203 	add	ix,sp
   0128 21 EF FF            204 	ld	hl,#-17
   012B 39                  205 	add	hl,sp
   012C F9                  206 	ld	sp,hl
                            207 ;font.c:55: fnt_get_font_info(font, &bpg, &gl, &xmax, &descent, &xmin, &addr0, &glyph_size);
   012D 21 08 00            208 	ld	hl,#0x0008
   0130 39                  209 	add	hl,sp
   0131 4D                  210 	ld	c,l
   0132 44                  211 	ld	b,h
   0133 21 0A 00            212 	ld	hl,#0x000A
   0136 39                  213 	add	hl,sp
   0137 EB                  214 	ex	de,hl
   0138 21 0C 00            215 	ld	hl,#0x000C
   013B 39                  216 	add	hl,sp
   013C DD 75 F5            217 	ld	-11 (ix),l
   013F DD 74 F6            218 	ld	-10 (ix),h
   0142 21 0D 00            219 	ld	hl,#0x000D
   0145 39                  220 	add	hl,sp
   0146 DD 75 F3            221 	ld	-13 (ix),l
   0149 DD 74 F4            222 	ld	-12 (ix),h
   014C 21 0E 00            223 	ld	hl,#0x000E
   014F 39                  224 	add	hl,sp
   0150 DD 75 F1            225 	ld	-15 (ix),l
   0153 DD 74 F2            226 	ld	-14 (ix),h
   0156 21 0F 00            227 	ld	hl,#0x000F
   0159 39                  228 	add	hl,sp
   015A DD 75 EF            229 	ld	-17 (ix),l
   015D DD 74 F0            230 	ld	-16 (ix),h
   0160 FD 21 10 00         231 	ld	iy,#0x0010
   0164 FD 39               232 	add	iy,sp
   0166 C5                  233 	push	bc
   0167 D5                  234 	push	de
   0168 DD 6E F5            235 	ld	l,-11 (ix)
   016B DD 66 F6            236 	ld	h,-10 (ix)
   016E E5                  237 	push	hl
   016F DD 6E F3            238 	ld	l,-13 (ix)
   0172 DD 66 F4            239 	ld	h,-12 (ix)
   0175 E5                  240 	push	hl
   0176 DD 6E F1            241 	ld	l,-15 (ix)
   0179 DD 66 F2            242 	ld	h,-14 (ix)
   017C E5                  243 	push	hl
   017D DD 6E EF            244 	ld	l,-17 (ix)
   0180 DD 66 F0            245 	ld	h,-16 (ix)
   0183 E5                  246 	push	hl
   0184 FD E5               247 	push	iy
   0186 DD 6E 04            248 	ld	l,4 (ix)
   0189 DD 66 05            249 	ld	h,5 (ix)
   018C E5                  250 	push	hl
   018D CDr00s00            251 	call	_fnt_get_font_info
   0190 21 10 00            252 	ld	hl,#0x0010
   0193 39                  253 	add	hl,sp
   0194 F9                  254 	ld	sp,hl
   0195 DD F9               255 	ld	sp,ix
   0197 DD E1               256 	pop	ix
   0199 C9                  257 	ret
   019A                     258 _fnt_measure_string_end::
                            259 	.area _CODE
                            260 	.area _CABS
